{%include "header.html"%}


  <form action="" method="POST" enctype="multipart/form-data">
                {% csrf_token %}

{% if form.errors %}
    {% for field in form %}
        {% for error in field.errors %}
        <div class="alert alert-danger mb-2 mt-2">
                <p class="mb-0">{{ error|escape }}</p>
            </div>

        {% endfor %}
    {% endfor %}
    {% for error in form.non_field_errors %}
        <div class="alert alert-danger mb-2 mt-2">
                <p class="mb-0">{{ error|escape }}</p>
            </div>
    {% endfor %}
{% endif %}

    <div class="container" style="margin-top: 5rem">
        <div class="card-obj">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Создать объявление</h5>
                <div class="row mt-4" style="display: block; margin-left: 4rem; width: 35rem">
                    <div class="col col-sm-7">
                        <label class="form-label" for="selectReg">Регион</label>
                        {{ postForm.region }}

                    </div>
                    <div class="col col-sm-7">
                        <div class="city-c mb-3">
                            <label class="form-label">Город</label>
                            {{ postForm.city }}
                        </div>
                    </div>
                    <div class="col col-sm-7">
                        <div class="city-c mb-3">
                            <label class="form-label">Улица</label>
                            {{ postForm.street }}
                        </div>
                    </div>
                    <div class="col col-sm-7">
                        <label for="sampleSelect2" class="form-label">Тип</label>
                        {{ postForm.type }}

                    </div>
                    <div class="col col-sm-7">
                        <label for="sampleSelect" class="form-label">Тип объекта</label>
                        {{ postForm.item_type }}
                    </div>
                    <div class="col col-sm-7">
                        <div class="phone-c mb-3">
                            <label class="form-label">Номер телефона</label>
                            {{ postForm.phone_number }}
                        </div>
                        <div class="phone-c mb-3">
                            <label class="form-label">Стоимость</label>
                            {{ postForm.price }}
                        </div>
                    </div>
                    <div class="col col-sm-7">

                        <div class="floor-c mb-3" data-select="#sampleSelect" data-option="com" hidden="until-found">
                            <label class="form-label">Этаж</label>
                            {{ postForm.com_floor }}
                        </div>
                        <div class="floor-c mb-3" data-select="#sampleSelect" data-option="flat" hidden="until-found">
                            <label class="form-label">Этаж</label>
                            {{ postForm.flat_floor }}
                        </div>
                    </div>
                    <div class="col col-sm-7">
                        <div class="floor-al-c mb-3" data-select="#sampleSelect" data-option="house" hidden="until-found">
                            <label class="form-label">Этажей всего</label>
                            {{ postForm.house_total_floor }}
                        </div>
                        <div class="floor-al-c mb-3" data-select="#sampleSelect" data-option="com" hidden="until-found">
                            <label class="form-label">Этажей всего</label>
                            {{ postForm.com_total_floor }}

                        </div>
                    </div>
                    <div class="col col-sm-7">
                        <div class="house-mat-c mb-3" data-select="#sampleSelect" data-option="house" hidden="until-found">
                            <label class="form-label">Материалы</label>
                            {{ postForm.house_material }}
                        </div>
                        <div class="g-mat-c mb-3" data-select="#sampleSelect" data-option="garage" hidden="until-found">
                            <label class="form-label">Материалы</label>
                            {{ postForm.garage_material }}
                        </div>
                        <div class="com-mat-c mb-3" data-select="#sampleSelect" data-option="com" hidden="until-found">
                            <label class="form-label">Материалы</label>
                            {{ postForm.com_material }}
                        </div>
                        <div class="f-mat-c mb-3" data-select="#sampleSelect" data-option="flat" hidden="until-found">
                            <label class="form-label">Материалы</label>
                            {{ postForm.flat_material }}
                        </div>
                    </div>
                    <div class="col col-sm-7">
                        <div class="a-all-c mb-3" >
                            <label class="form-label">Площадь общая</label>
                            {{ postForm.total_surface }}
                        </div>

                    </div>
                    <div class="col col-sm-7">
                        <div class="a-l-c mb-3" data-select="#sampleSelect" data-option="flat" hidden="until-found">
                            <label class="form-label">Жилая площадь</label>
                             {{ postForm.flat_livin_surface }}
                        </div>
                        <div class="a-l-c mb-3" data-select="#sampleSelect" data-option="house" hidden="until-found">
                            <label class="form-label">Жилая площадь</label>
                             {{ postForm.house_livin_surface }}
                        </div>
                    </div>
                    <div class="col col-lg-12">
                        <div class="desc-c mb-3">
                            <label class="form-label">Описание</label>
                            {{ postForm.description }}
                        </div>

                    </div>
                    <div class="col col-md-6">
                        <div id="form-container" class="add-f mb-3">
                            <label class="form-label">Добавить фотографии</label>
                            {{formset.management_form}}
                            {% for form in formset %}
                            <div class="bird-form" style="margin: 3%">
                                {{form.image}}
                            </div>
                            {% endfor %}
                            <button id="add-form" type="button">Добавить изображение</button>
                        </div>

                    </div>
                    <div class="col col-sm-7">
                        <div class="b-accept mb-3">
                            <button type="submit" class="btn btn-primary btn-sm">Добавить объявление</button>
                        </div>

                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>
<script>
// Ждем когда вся страница загрузится
        document.addEventListener('DOMContentLoaded', function () {
            const SELECT_ID = '#sampleSelect'; // айдишник селекта

            // Получаем элемент селекта
            const sampleSelect = document.querySelector(SELECT_ID);
            // Получаем все инпуты, которые относятся к этому селекту:
            const inputs = document.querySelectorAll(`[data-select="${SELECT_ID}"]`)

            // Добавляем событие на изменение выбора в селекте
            sampleSelect.addEventListener('change', function(e) {
                const optionValue = e.currentTarget.value; // Получаем выбранное значение

                /*
                    Перебираем все связанные с селектом инпуты, если опция не выбрана в селекте,
                    то скрываем инпут иначе отображаем
                 */
                inputs.forEach((input) => {
                    if (input.dataset.option === optionValue) {
                        input.removeAttribute('hidden')
                    } else {
                        input.setAttribute('hidden', '')
                    }
                })
            })
        });
        let birdForm = document.querySelectorAll(".bird-form")
        let container = document.querySelector("#form-container")
        let addButton = document.querySelector("#add-form")
        let totalForms = document.querySelector("#id_form-TOTAL_FORMS")

        let formNum = birdForm.length-1
        addButton.addEventListener('click', addForm)

        function addForm(e){
            e.preventDefault()

            let newForm = birdForm[0].cloneNode(true)
            let formRegex = RegExp(`form-(\\d){1}-`,'g')

            formNum++
            newForm.innerHTML = newForm.innerHTML.replace(formRegex, `form-${formNum}-`)
            container.insertBefore(newForm, addButton)

            totalForms.setAttribute('value', `${formNum+1}`)
        };




    </script>
{%include "footer.html"%}